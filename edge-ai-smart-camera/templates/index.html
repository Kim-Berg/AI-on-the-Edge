<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"        .alert-danger {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .controls-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
        }="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge AI Smart Camera Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <style>
        .video-container {
            position: relative;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .video-feed {
            width: 100%;
            height: auto;
            max-height: 480px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-live { background-color: #28a745; animation: pulse 2s infinite; }
        .status-offline { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .alert-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .alert-critical {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .detection-zone {
            position: absolute;
            border: 2px dashed #28a745;
            background: rgba(40, 167, 69, 0.1);
            pointer-events: none;
        }
        
        .controls-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-video"></i> Edge AI Smart Camera
            </span>
            <span class="navbar-text">
                <span class="status-indicator status-live"></span>
                <span id="connection-status">Live Processing</span>
            </span>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Main Dashboard Row -->
        <div class="row">
            <!-- Live Video Feed -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-camera"></i> Live Camera Feed</h5>
                        <div>
                            <span class="badge bg-success">AI Processing Active</span>
                            <span class="badge bg-info" id="fps-counter">0 FPS</span>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="video-container">
                            <img src="/video_feed" alt="Camera Feed" class="video-feed" id="video-feed">
                        </div>
                    </div>
                </div>

                <!-- Detection Controls -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-sliders-h"></i> Detection Controls</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">

                            <div class="col-md-3">
                                <div class="controls-panel">
                                    <h6>Object Detection</h6>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="detect-people" checked>
                                        <label class="form-check-label" for="detect-people">Detect People</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="detect-vehicles" checked>
                                        <label class="form-check-label" for="detect-vehicles">Detect Vehicles</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="object-tracking" checked>
                                        <label class="form-check-label" for="object-tracking">Object Tracking</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="controls-panel">
                                    <h6>Anomaly Detection</h6>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="loitering-detection" checked>
                                        <label class="form-check-label" for="loitering-detection">Loitering Detection</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="movement-analysis" checked>
                                        <label class="form-check-label" for="movement-analysis">Movement Analysis</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="crowd-detection">
                                        <label class="form-check-label" for="crowd-detection">Crowd Detection</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="controls-panel">
                                    <h6>Alert Settings</h6>
                                    <label for="confidence-threshold" class="form-label">Confidence Threshold</label>
                                    <input type="range" class="form-range" id="confidence-threshold" min="0.1" max="1.0" step="0.1" value="0.5">
                                    <small class="form-text">Current: <span id="threshold-value">0.5</span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics and Alerts Sidebar -->
            <div class="col-lg-4">
                <!-- Real-time Metrics -->
                <div class="row mb-4">
                    <div class="col-6">
                        <div class="metric-card text-center">
                            <div class="metric-value" id="current-people">0</div>
                            <div class="metric-label">People Detected</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="metric-card text-center">
                            <div class="metric-value" id="processing-time">0ms</div>
                            <div class="metric-label">Processing Time</div>
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5><i class="fas fa-microchip"></i> Edge AI Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="h4 text-primary" id="total-detections">0</div>
                                <small>Total Detections</small>
                            </div>
                            <div class="col-4">
                                <div class="h4 text-success" id="people-count">0</div>
                                <small>Max People</small>
                            </div>
                            <div class="col-4">
                                <div class="h4 text-info" id="vehicles-count">0</div>
                                <small>Vehicles</small>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="mb-2">
                            <strong>AI Model:</strong> 
                            <span class="badge bg-success">Loaded</span>
                        </div>
                        <div class="mb-2">
                            <strong>Edge Processing:</strong> 
                            <span class="badge bg-success">Active</span>
                        </div>
                        <div class="mb-2">
                            <strong>Camera Status:</strong> 
                            <span class="badge bg-success">Connected</span>
                        </div>
                        <div>
                            <strong>Privacy Mode:</strong> 
                            <span class="badge bg-info">Local Only</span>
                        </div>
                    </div>
                </div>

                <!-- Security Alerts -->
                <div class="card">
                    <div class="card-header bg-warning text-dark d-flex justify-content-between">
                        <h5><i class="fas fa-exclamation-triangle"></i> Security Alerts</h5>
                        <span class="badge bg-danger" id="alert-count">0</span>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="alerts-container">
                            <div class="text-muted text-center">
                                <i class="fas fa-shield-alt fa-2x mb-2"></i>
                                <p>No security alerts</p>
                                <small>System monitoring for anomalies...</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Demo Information -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5><i class="fas fa-info-circle"></i> Demo Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <h6>Edge AI Benefits</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-bolt text-warning"></i> <50ms latency</li>
                                    <li><i class="fas fa-shield-alt text-success"></i> Privacy preserved</li>
                                    <li><i class="fas fa-wifi text-danger"></i> Works offline</li>
                                    <li><i class="fas fa-dollar-sign text-info"></i> No cloud costs</li>
                                </ul>
                            </div>
                            <div class="col-md-3">
                                <h6>Detection Features</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-eye text-primary"></i> Object detection</li>
                                    <li><i class="fas fa-route text-success"></i> Person tracking</li>
                                    <li><i class="fas fa-exclamation text-warning"></i> Anomaly alerts</li>
                                    <li><i class="fas fa-clock text-info"></i> Loitering detection</li>
                                </ul>
                            </div>
                            <div class="col-md-3">
                                <h6>Use Cases</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-building"></i> Building security</li>
                                    <li><i class="fas fa-store"></i> Retail analytics</li>
                                    <li><i class="fas fa-road"></i> Traffic monitoring</li>
                                    <li><i class="fas fa-hard-hat"></i> Safety compliance</li>
                                </ul>
                            </div>
                            <div class="col-md-3">
                                <h6>Technologies</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fab fa-python"></i> Python + OpenCV</li>
                                    <li><i class="fas fa-brain"></i> YOLO/SSD models</li>
                                    <li><i class="fas fa-server"></i> Edge inference</li>
                                    <li><i class="fas fa-chart-line"></i> Real-time analytics</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize Socket.IO connection
        const socket = io();
        
        // Socket event handlers
        socket.on('camera_update', function(data) {
            console.log('Received camera update:', data);
            updateStats(data.stats);
            updateAlerts(data.stats.alerts);
        });
        
        socket.on('connect', function() {
            document.getElementById('connection-status').textContent = 'Live Processing';
            document.querySelector('.status-indicator').className = 'status-indicator status-live';
        });
        
        socket.on('disconnect', function() {
            document.getElementById('connection-status').textContent = 'Disconnected';
            document.querySelector('.status-indicator').className = 'status-indicator status-offline';
        });
        
        // Camera selection removed - using fixed camera 1
        
        // Camera selection removed - using fixed camera 1
        
        function updateStats(stats) {
            // Update main metrics
            document.getElementById('current-people').textContent = stats.current_people || 0;
            document.getElementById('processing-time').textContent = Math.round(stats.avg_processing_time || 0) + 'ms';
            
            // Update detailed stats
            document.getElementById('total-detections').textContent = stats.total_detections || 0;
            document.getElementById('people-count').textContent = stats.people_count || 0;
            document.getElementById('vehicles-count').textContent = stats.vehicles_count || 0;
            
            // Update alert count
            document.getElementById('alert-count').textContent = (stats.alerts && stats.alerts.length) || 0;
        }
        
        function updateAlerts(alerts) {
            const container = document.getElementById('alerts-container');
            
            if (!alerts || alerts.length === 0) {
                container.innerHTML = `
                    <div class="text-muted text-center">
                        <i class="fas fa-shield-alt fa-2x mb-2"></i>
                        <p>No security alerts</p>
                        <small>System monitoring for anomalies...</small>
                    </div>
                `;
                return;
            }
            
            // Show recent alerts (last 10)
            const recentAlerts = alerts.slice(-10).reverse();
            
            container.innerHTML = recentAlerts.map(alert => {
                const alertClass = alert.type.includes('Rapid') ? 'alert-critical' : 'alert-item';
                const icon = alert.type.includes('Loitering') ? 'fa-clock' : 'fa-running';
                const time = new Date(alert.timestamp).toLocaleTimeString();
                
                return `
                    <div class="${alertClass}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <strong><i class="fas ${icon}"></i> ${alert.type}</strong>
                                <br>
                                <small>Track ID: ${alert.track_id} | Confidence: ${(alert.confidence * 100).toFixed(0)}%</small>
                            </div>
                            <small class="text-muted">${time}</small>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Control event handlers
        document.getElementById('confidence-threshold').addEventListener('input', function(e) {
            document.getElementById('threshold-value').textContent = e.target.value;
        });
        
        // Simulate FPS counter
        let frameCount = 0;
        setInterval(() => {
            frameCount++;
            if (frameCount % 10 === 0) {  // Update every second (assuming 10 FPS)
                document.getElementById('fps-counter').textContent = '10 FPS';
            }
        }, 100);
        
        // Demo helper functions
        function showDemoAlert() {
            // Simulate a demo alert
            const demoAlert = {
                type: 'Loitering Detected',
                track_id: Math.floor(Math.random() * 1000),
                confidence: 0.85,
                timestamp: new Date().toISOString()
            };
            
            updateAlerts([demoAlert]);
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Edge AI Smart Camera Dashboard loaded');
            
            // Show demo message
            setTimeout(() => {
                if (document.getElementById('total-detections').textContent === '0') {
                    console.log('Demo mode: Using test pattern for camera feed');
                }
            }, 2000);
        });
    </script>
</body>
</html>